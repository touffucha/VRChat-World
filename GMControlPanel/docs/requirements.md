# TRPG用GMコントロールパネル 要件定義

## 1. 基本仕様

### 1.1 システム構成
- **表示方式**: 浮遊追従型（GM専用ローカル表示）
- **UI構造**: 手首クイックアクセス + 展開式メインパネル
- **制御対象**: 6シーン × 各2ギミック = 計12ギミック
- **技術基盤**: Udon# + uGUI（WorldSpace Canvas）

### 1.2 パネル構成
```
【手首パネル】（常時表示・小型）
├ 現在シーン表示
├ クイックテレポート
└ メインパネル展開ボタン

【メインパネル】（展開時・大型）
├ シーン選択エリア（6シーン）
├ ギミック制御エリア（現在シーン用）
├ ロール選択エリア（テレポート対象）
└ システム制御エリア
```

## 2. 機能要件

### 2.1 シーン管理システム
**シーン構成**: VRChatワールドでは、テレポート、ライティング制御、オブジェクト表示/非表示、音響制御などが基本的なギミックとして使用されます。

```
Scene 1: オープニング
├ ギミック1: 導入BGM制御
└ ギミック2: 雰囲気ライティング

Scene 2: 探索フェーズ  
├ ギミック1: 環境音切り替え
└ ギミック2: 調査エフェクト

Scene 3: 遭遇フェーズ
├ ギミック1: 戦闘BGM制御
└ ギミック2: 緊張演出ライト

Scene 4: クライマックス
├ ギミック1: ドラマティック演出
└ ギミック2: 特殊エフェクト

Scene 5: 解決フェーズ
├ ギミック1: 解決BGM
└ ギミック2: 安堵ライティング

Scene 6: エンディング
├ ギミック1: エンディングBGM
└ ギミック2: 締めくくり演出
```

### 2.2 汎用ギミック制御
音響制御では2D音源（BGM）と3D音源（効果音）の使い分けが重要で、VRC Spatial Audio Sourceによる距離減衰やリバーブ設定を活用します。

**制御可能ギミック種別**:
- **音響系**: BGM切り替え、環境音、効果音、音量調整
- **照明系**: メインライト、カラーライト、点滅効果、暗転
- **視覚系**: パーティクル、フェードエフェクト、オブジェクト表示
- **演出系**: アニメーション再生、カメラエフェクト

### 2.3 ロール管理システム
```
テレポート対象選択:
☑ 参加者（基本対象）
☑ 相手役（選択可能）  
☐ 観戦者（基本対象外）
☐ GM（移動しない）
```

## 3. UI設計仕様

### 3.1 技術実装
uGUIではCanvasのRenderModeをWorldSpaceにし、VRC_UiShapeコンポーネントを追加する必要があります。

```csharp
// ローカル表示制御
if (Networking.LocalPlayer == gmPlayer)
{
    controlPanel.SetActive(true);
    // パネル追従設定
    panelTransform.SetParent(gmPlayerHead);
}
```

### 3.2 レスポンシブ設計
- **手首パネル**: 80×60px（最小限情報）
- **メインパネル**: 400×300px（操作用）
- **ボタンサイズ**: 40×30px（VR操作対応）
- **フォント**: VRChat推奨フォント（視認性重視）

### 3.3 操作フロー
```
1. 手首タップ → メインパネル展開
2. シーン選択 → 対象ロール選択 → テレポート実行
3. ギミック選択 → 効果調整 → 実行
4. 一定時間無操作 → 自動格納
```

## 4. 技術制約・考慮事項

### 4.1 VRChat制約
- **Udon制限**: LINQ、async/await、genericsは使用不可
- **パフォーマンス**: Quest対応考慮（軽量化必須）
- **同期**: 重要な状態のみネットワーク同期
- **UI制限**: VRChat対応UI要素のみ使用

### 4.2 拡張性確保
- **設定ファイル化**: シーン構成を外部設定で変更可能
- **ギミック追加**: 新規ギミック種別の動的追加対応
- **カスタマイズ**: パネルレイアウトの調整機能

## 5. 運用想定

### 5.1 操作パターン
- **基本進行**: シーン移動 → ギミック1実行 → ギミック2実行
- **演出強化**: 複数ギミック同時実行
- **緊急対応**: クイック操作による即座対応

### 5.2 パフォーマンス目標
- **応答速度**: ボタン押下から実行まで1秒以内
- **同期遅延**: 全プレイヤー反映まで3秒以内
- **メモリ使用**: 基本ギミック込みで50MB以内